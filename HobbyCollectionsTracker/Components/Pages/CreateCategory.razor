@page "/categories/create"
@attribute [Authorize(Roles = "Admin")]
@rendermode InteractiveServer

@using System.ComponentModel.DataAnnotations
@using HobbyCollectionsTracker.Data
@using HobbyCollectionsTracker.Models
@using System.Threading.Tasks
@inject ApplicationDbContext Db
@inject NavigationManager Nav

<PageTitle>Create Category - HCT</PageTitle>

@* Crete Category Page *@
<div class="hh-page-container">
  <h1 class="hh-page-title">Create Category</h1>

  <div class="hh-surface">
    @* Form to Create a category *@
    <EditForm Model="@category" OnValidSubmit="HandleValidSubmit" class="hh-form-narrow">
      <DataAnnotationsValidator />
      <ValidationSummary />
      
      @* To insert the new category name *@
      <div class="mb-3 hh-form-row">
        <label for="name" class="form-label hh-field-label">Name</label>
        <div>
          <InputText id="name" class="form-control" @bind-Value="category.Name" />
          <ValidationMessage For="@(() => category.Name)" />
        </div>
      </div>
      
      @* Submit to database button *@
      <div class="hh-form-actions">
        <button type="submit" class="btn btn-primary">Save</button>
        <a class="btn btn-secondary ms-2" href="/categories">Cancel</a>
      </div>
    </EditForm>
  </div>
</div>

@code {
  private Category category = new();

  // Called when the Create Post form passes validation.
  // Sets the current user as the owner of the post and saves it to the database.
  private async Task HandleValidSubmit()
  {
    Db.Categories.Add(category);
    await Db.SaveChangesAsync();
    Nav.NavigateTo("/categories");
  }
}